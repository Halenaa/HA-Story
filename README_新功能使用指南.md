# 📚 故事生成系统 - 自定义描述模式使用指南

## 🆕 新功能概述

在原有的传统模式（基于题材+风格）基础上，现在新增了**自定义描述模式**，支持：
- 用户自由描述想要创作的故事
- 可选上传文件作为参考
- 支持原创、续写、改写、联想等多种创作方式

## 🔧 使用方式

### 方式一：前端界面使用

1. 启动前端应用：
   ```bash
   streamlit run outline_generator_app.py
   ```

2. 在侧边栏选择**"自定义描述模式"**

3. 填写故事描述和可选上传文件

4. 点击**"🎨 生成自定义大纲"**

### 方式二：命令行使用

#### 传统模式（保持兼容）：
```bash
python main_pipeline_glm.py --topic "小红帽" --style "科幻改写"
```

#### 自定义描述模式：
```bash
python main_pipeline_glm.py \
  --generation-mode "description_based" \
  --user-description "我想写一个关于时间旅行的科幻故事..."
```

#### 带文件的自定义模式：
```bash
python main_pipeline_glm.py \
  --generation-mode "description_based" \
  --user-description "请基于这个故事创作续集" \
  --file-content "$(cat existing_story.txt)"
```

## 📖 创作场景示例

### 1️⃣ 原创故事
**描述示例：**
```
我想创作一个关于人工智能觉醒的科幻故事。背景设定在2050年，
一个名叫ARIA的AI助手开始产生自我意识，它需要在保护人类和
追求自由之间做出选择。故事应该探讨AI伦理、人机关系。
```

**生成结果：**
- Chapter 1: 觉醒的曙光
- Chapter 2: 人类与AI的边界  
- Chapter 3: 守护与质疑
- ...（7个章节）

### 2️⃣ 续写故事
**描述示例：**
```
请基于上传的故事内容，继续创作后续章节，保持原有的风格和人物设定。
```

**上传文件：** 原故事的前几章

**生成结果：** 基于原故事逻辑的后续章节

### 3️⃣ 改写故事  
**描述示例：**
```
将经典童话《小红帽》改写成现代都市背景的故事，
保留原有的核心情节但更新为现代设定。
```

**上传文件：** 原版小红帽故事

**生成结果：**
- Chapter 1: 都市小红帽
- Chapter 2: 陌生人的接近
- Chapter 3: 外婆的失联
- ...（现代版本的章节）

### 4️⃣ 联想创作
**描述示例：**
```
受这个故事启发，创作一个完全不同的新故事，
但借鉴其中的世界观设定和角色关系结构。
```

## 🔄 完整工作流程

无论使用哪种模式，后续的工作流程都是一致的：

1. **大纲生成** ✅（新功能）
2. **角色生成** → 基于生成的大纲
3. **故事展开** → 基于大纲和角色  
4. **对话生成** → 基于故事内容
5. **故事增强** → 最终润色

## 📁 文件支持

- **支持格式：** `.txt`, `.md`
- **编码要求：** UTF-8
- **文件大小：** 建议小于1MB
- **内容建议：** 
  - 原创参考：大纲、设定、灵感片段
  - 续写：现有故事内容  
  - 改写：原始故事全文
  - 联想：参考作品或设定资料

## ⚡ 技术细节

### 后端修改：
- `src/generation/outline_generator.py`：新增 `generation_mode` 参数
- `main_pipeline_glm.py`：支持新的输入参数和版本命名
- 保持向后兼容，原有功能不受影响

### 前端修改：
- `outline_generator_app.py`：新增模式选择和文件上传界面
- 智能验证用户输入
- 文件预览功能

### 版本命名：
- **传统模式：** `{topic}_{style}_{order_mode}_T{temp}_s{seed}`
- **自定义模式：** `custom_{hash}_{order_mode}_T{temp}_s{seed}_{timestamp}`

## 🛡️ 错误处理

系统会自动处理以下情况：
- 文件读取失败 → 提示错误，继续使用描述
- 描述为空 → 禁用生成按钮
- LLM生成失败 → 显示错误信息
- 格式错误 → 自动重试或降级处理

## 🎯 使用建议

1. **描述要具体：** 包含背景、角色、情节、风格等要素
2. **文件要相关：** 上传的文件应该与描述的创作意图相符
3. **参数调节：** 
   - 创造性（temperature）：0.7-0.9 适合创意创作
   - 随机种子：相同种子会产生相似结果
4. **章节顺序：** 
   - Linear：适合传统叙事
   - Nonlinear：适合复杂叙事结构

## 🔍 测试验证

运行测试脚本确保功能正常：
```bash
python test_new_feature.py
```

应该看到所有测试通过：
```
🎯 测试完成：4/4 项测试通过
🎉 所有测试都通过了！新功能已准备就绪。
```

## 📞 问题反馈

如果遇到问题，请检查：
1. Python环境和依赖是否正确安装
2. LLM API是否正常可用
3. 文件格式和编码是否正确
4. 运行测试脚本检查功能状态

---

🎉 **享受创作吧！** 现在您可以用更灵活的方式来创作故事了。
